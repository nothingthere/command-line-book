# 包管理

一个linux版本（disttribution）的好坏，取决于_包管理系统_和_社区活跃程度_，因为软件更替速度相当快。

包管理是指安装和维护软件的方法。如今，基本上所有包都可以从不同版本的发行方获取。早期，安装软件下载并编译_源代码_，此方法只是不太方便，需获取系统更高的控制权？。

## 包管理系统

不同发行版本有自己的包管理系统，且互不兼容。除Gentoo、 Slackware和Arch等外，绝大多数版本分为了2大阵营：Debian的".deb"和Red Hat的".rpm"。

包管理系统            | 版本（部分）
:--------------- | :----------------------------------------------
Debaian风格（.deb）  | Debain、Ubuntu、Linux Mint、Raspbian
Read Hat风格（.rpm） | Fedora、CentOS、Red Hat Enterprise Linux、OpenSUSE

## 包管理系统如何工作

Linux所有的安装包都可通过网路获取。存在方式有2中：绝大多数由版本供应商以_包文件_的形式提供；其余部分为需手动安装的源代码。

### 包文件

包系统中，软件以_包文件_为基础单位。一个包文件即组成软件包的压缩文件。一个安装包可由无数程序和数据文件组成。除需安装的文件外，包文件还包含有关此包的元数据（metadata），如对此包的描述文本和内容。此外，许多包还包含前处理和后处理脚本（pre-and-post installation），用来配置整个安装过程。

包文件由_包维护者_（通常是版本供应商雇员）编写。包维护者从_上传者_（程序作者）处获取源码，对其编译，并编写元数据和任何安装所需脚本。通常情况下，包维护者还会修改源码，以提高在不同系统版本中的兼容性。

### 包仓库

尽管一些软件工程选择只管理自己的包管理系统和版本，大如今大多数都由版本供应商和第三方创建。用户可在中心仓库中下载和安装包，这些中心仓库下可包含成千上万的包，每个包都为特定版本创建？。

一个系统版本可能维护多个项目，每个项目针对软件开发的不如阶段。比如"测试（testing）"仓库，开放供大神些使用，一边寻找bug；"开发（development）"仓库，包含一些下一个大版本的新特性。

一个系统版本也可能有第三方仓库。如因法律条款不允许的软件，可由各国自行建立仓库。这些仓库独立于系统版本，需手动设置，使其在当前版本中生效。

### 依赖

一个程序很少独立于其它程序工作，比如I/O程序就被多个许多程序共享，也就是这些共享I/O程序的程序依赖I/O程序。现代包管理系统提供了_依赖修复_功能，当安装某个程序时，同时也安装其依赖程序。

### 高级和低级包工具

包管理系统通常由2类工具组成：

- 低级工具（low-level tools）。处理包安装和包卸载等任务。
- 高级工具（high-level tools）。处理元数据搜索和依赖修复任务。

不同阵营使用的包系统工具命令不同：

版本                       | 低级工具   | 高级工具
:----------------------- | :----- | :----
Debian风格                 | `dpkg` | `apt`
Fedora，CentOS和Red Hat企业班 | `rpm`  | `yum`

## 常用的包管理任务

### 在项目中寻找包

使用高级包管理工具可通过包名和关键字，在仓库元数据中搜索对应包。

包搜索命令：

阵营      | 命令
:------ | :------------------
Debian  | apt search _名称或关键字_
Red Hat | yum search _名称或关键字_

**比如在Ubuntu中搜索"emacs"编辑器：**

```bash
me@ubuntu16.04:~$ apt search emacs
...
```

### 从项目中安装包

使用高级包管理工具，可从仓库下载一个包并安装，同时还可解决依赖问题。

包安装命令：

阵营      | 命令
:------ | :-------------------
Debian  | apt install _名称或关键字_
Red Hat | yum install _名称或关键字_

**比如在Ubuntu中安装"emacs"编辑器：**

```bash
me@ubuntu16.04:~$ apt install emacs
...
```

### 用文件安装包

如果是下载的源码，需使用低级包管理工具安装。但不能自动解决依赖问题，依赖缺失时会报错。低级包管理工具对应命令：

阵营      | 命令
:------ | :-----------------------
Debain  | dpkg --install _已下载的文件名_
Red Hat | rmp -i _已下载的文件名_

**以Ubuntu安装搜狗拼音为例：**

```bash
me@ubuntu16.04:~$ dpkg --install sogoupinyin_2.0.0.0078_amd64.deb
...
```

### 卸载包

高级和低级包管理工具都可卸载包。原则为高级工具卸载高级工具安装的包，低级工具卸载低级工具安装的包。

阵营      | 高级命令            | 低级命令
:------ | :-------------- | :-----------------
Debain  | apt remove _包名_ | dpkg --remove _包名_
Red Hat | yum erase _包名_  | ?

**卸载emacs：**

```bash
me@ubuntu16.04:~$ apt remove emacs
...
```

### 更新包

包管理工具最重要的任务就是跟新所有安装包，只需一个命令就可实现：

阵营       | 命令
:------- | :---------------------
Debian   | apt update;apt upgrade
Red Hate | yum upgrade

如果是使用低级包管理工具安装的包，Debian中只有重新安装，实现更新；Red Hat中则可使用`rpm`命令的"-U"选项：

阵营      | 命令
:------ | :------------------------------
Debian  | dpkg --install _需要跟新的包对应的新下载文件_
Red Hat | rpm -U _需要跟新的包对应的新下载文件_

### 列出所有已安装包

阵营      | 命令
:------ | :----------
Debian  | dpkg --list
Red Hat | rpm -qa

### 查看一个包是否已安装

阵营      | 命令
:------ | :-----------------
Debian  | dpkg --status _包名_
Red Hat | rpm -q _包名_

### 查看一个已安装包的描述信息

阵营      | 命令
:------ | :------------------
Debian  | apt-cache show _包名_
Red Hat | yum info _包名_

### 查看已安装包的安装文件？

查看包安装后，写入了哪些文件？：

阵营      | 命令
:------ | :---------------------
Debian  | dpkg --search _包名/关键字_
Red Hat | rpm -df _包名/关键字_
