# 命令处理

此节探索在按下<kbd>Enter</kbd>后命令行如何处理命令。只学习一个命令：

-   **echo**：输出

## 膨胀（Expansion）

输入命令，按下<kbd>Enter</kbd>后，如”\*“，bash将命令处理后，shell才执行。bash处理的过程称为膨胀（expasion)。

**首先学习echo命令，该命令将其文本参数输出到标准输出流。：**

```bash
me@ubuntu16.04:~$ echo this is a test
this is a test
```

### 路径膨胀 \*

当echo的参数中含“\*”时，此符号处理为路径膨胀。

**当前文件夹中的文件：**

```bash
me@ubuntu16.04:~$ ls
Desktop    Downloads  examples.desktop  Music     Public     Videos
Documents  dwhelper   io
```

**路径膨胀：**

```bash
me@ubuntu16.04:~$ echo D*
Desktop Documents Downloads
me@ubuntu16.04:~$ echo *s
Documents Downloads Pictures Templates Videos
me@ubuntu16.04:~$ echo [[:upper:]]*
Desktop Documents Downloads Music Pictures Public Templates Videos
```

### 波浪字符膨胀 ~

与cd命令相同，“~”表示用户的home文件夹路径。

**只有"~"符号，显示当前用户home目录：**

```bash
me@ubuntu16.04:~$ echo ~
/home/me
```

**跟上用户名，如果用户名存在，显示该用户home目录：**

```bash
me@ubuntu16.04:~$ echo ~foo
/home/foo
```

### 数学运算膨胀 $(())

基本形式：

```bash
echo $((数学表达式))
```

**如：**

```bash
me@ubuntu16.04:~$ echo $(( 2 + 2))
4
```

**表达式之间空格无要求，且可嵌套：**

```bash
me@ubuntu16.04:~$ $(( $((5**2)) * 3 ))
75
```

**内部可使用()组合表达式：**

```bash
me@ubuntu16.04:~$ echo $(( (5**2) * 3 ))
75
```

**只支持整数计算，小数忽略：**

```bash
me@ubuntu16.04:~$ echo 5除以2等于$((5/2))
5除以2等于2
```

支持的运算符：

| 运算符  | 描述        |
| :--- | :-------- |
| +    | 加         |
| -    | 减         |
| \*   | 乘         |
| /    | 除。结果始终为整数 |
| %    | 求模        |
| \*\* | 次方        |

### 花括号膨胀 ${}

利用花括号膨胀功能，可以使用一个模型创建同时创建多个字符串。

**可使用逗号隔开的列表形式：**

```bash
me@ubuntu16.04:~$ echo Front-{A,B,C}-Back
Front-A-Back Front-B-Back Front-C-Back
```

**也可使用“..”形式的“范围”形式：**

```bash
me@ubuntu16.04:~$ echo Number_{1..5} #数字范围
Number_1 Number_2 Number_3 Number_4 Number_5
me@ubuntu16.04:~$ echo Number_{01..5} #长度补齐
Number_01 Number_02 Number_03 Number_04 Number_05
me@ubuntu16.04:~$ echo Number_{001..5}
Number_001 Number_002 Number_003 Number_004 Number_005
me@ubuntu16.04:~$ echo {Z..A} #字母范围
Z Y X W V U T S R Q P O N M L K J I H G F E D C B A
```

**支持嵌套：**

```bash
me@ubuntu16.04:~$ echo a{A{1,2},B{3,4}}b #列表形式嵌套
aA1b aA2b aB3b aB4b
me@ubuntu16.04:~$ echo {1,{2..5}} #列表和范围形式混合嵌套
1 2 3 4 5
```

**利用此功能同时生成多个文件夹：**

```bash
me@ubuntu16.04:~$ mkdir Log
me@ubuntu16.04:~$ cd Log/
me@ubuntu16.04:~/Log$ mkdir {2016..2017}-{01..12}
me@ubuntu16.04:~/Log$ ls -p
2016-01/  2016-04/  2016-07/  2016-10/  2017-01/  2017-04/  2017-07/  2017-10/
2016-02/  2016-05/  2016-08/  2016-11/  2017-02/  2017-05/  2017-08/  2017-11/
2016-03/  2016-06/  2016-09/  2016-12/  2017-03/  2017-06/  2017-09/  2017-12/
me@ubuntu16.04:~/Log$ cd ..
me@ubuntu16.04:~$ rm -r Log/
```

### 系统参数膨胀 $参数

_在脚本文件中应用更常见。_

**参看所有系统参数：**

```bash
me@ubuntu16.04:~$ printenv | less
...
```

**以USER参数为例，显示其值：**

```bash
me@ubuntu16.04:~$ echo $USER
me
```

**如果参数不存在，不报错，但也不显示任何值：**

```bash
me@ubuntu16.04:~$ echo $SUER
```

### 命令替换 $(命令)

命令替换功能可将命令执行结果转换为表达式。

**将ls命令的执行结果作为表达式输出：**

```bash
me@ubuntu16.04:~$
me@ubuntu16.04:~$ echo $(ls)
Desktop Documents Downloads ...
```

**找到cp命令对应程序路径，并查看其文件信息：**

```bash
me@ubuntu16.04:~$ ls -l $(which cp)
-rwxr-xr-x 1 root root 151024 2月  18 21:37 /bin/cp
```

**结合管道使用：**

```bash
me@ubuntu16.04:~$ file $(ls -d /usr/bin/* | grep zip)
...
```

## 引号

学习了shell在背后如何处理命令后，现在来看看如何使用引号控制命令。

**观察下面2例：**

```bash
me@ubuntu16.04:~$ echo this is a       test
this is a test
me@ubuntu16.04:~$ echo The total is $100.00
The total is 00.00
```

-   第一例中，echo命令的参数间，多余的空格被移除。
-   第二例中，由于“$1”变量未定义，所以被空字符串替代。

### 双引号

如果将字符串放置在双引号内，除“$”、“\\”和“\`”（反引号）外的特殊字符都会失去其特殊意义。也就是说：

-   去除单词间多余的空格、路径膨胀、波浪线膨胀和花括号膨胀都会失去意义。
-   不过，参数膨胀、数学运算膨胀和命令替换依然有效。

**使用双引号保持单词间多余空格操作文件“two words.txt”：**

```bash
me@ubuntu16.04:~$ ls -l "two words.txt"
...
```

**参数膨胀、数学运算膨胀和命令替换依然有效：**

```bash
me@ubuntu16.04:~$ echo "$USER $((2+2)) $(cal)"
me 4       八月 2016         
日 一 二 三 四 五 六  
    1  2  3  4  5  6  
 7  8  9 10 11 12 13  
14 15 16 17 18 19 20  
21 22 23 24 25 26 27  
28 29 30 31
```

_shell如何去除单词间多余的空格：_ 仅将空格、tab和换行字符视作单词间的分隔符，不将其作为文本的一部分。所以要保留单词间的多余空格，需将整个文本用双引号包裹：

```bash
me@ubuntu16.04:~$ echo "this is a      test"
this is a      test
```

**下例中，第一个echo命令的参数有40个；而第二个echo命令只有一个双引号包裹起来的参数：**

```bash
me@ubuntu16.04:~$ echo $(cal)
八月 2016 日 一 二 三 四 五 六 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31
me@ubuntu16.04:~$ echo "$(cal)"
      八月 2016         
日 一 二 三 四 五 六  
    1  2  3  4  5  6  
 7  8  9 10 11 12 13  
14 15 16 17 18 19 20  
21 22 23 24 25 26 27  
28 29 30 31
```

### 单引号

单引号的作用是去除所有字符的特殊意义。

**观察下例：**

```bash
me@ubuntu16.04:~$ echo text ~/*.txt {a,b} $(echo foo) $((2+2)) $USER
text /home/claudio/two words.txt a b foo 4 claudio
me@ubuntu16.04:~$ echo "text ~/*.txt {a,b} $(echo foo) $((2+2)) $USER"
text ~/*.txt {a,b} foo 4 claudio
me@ubuntu16.04:~$ echo 'text ~/*.txt {a,b} $(echo foo) $((2+2)) $USER'
text ~/*.txt {a,b} $(echo foo) $((2+2)) $USE
```

**从没有引号、双引号到单引号，去除字符特殊意义越完全。**

### 转义字符

需转义字符，使用`\`。

**字符转义通常用在双引号内：**

```bash
me@ubuntu16.04:~$ echo "The balance for user $USER is: \$5.00"
The balance for user claudio is: $5.00
```

**也可用来转义文件名：**

```bash
me@ubuntu16.04:~$ mv bad\&filename good_filename
```

**在单引号内，字符转义没有意义。**

**打印控制字符时，echo命令需添加“-e”选项：**

```bash
me@ubuntu16.04:~$ echo "hello\nword"
hello\nword
me@ubuntu16.04:~$ echo -e "hello\nword"
hello
word
```

常用的控制字符有：

| 字符   | 含义              |
| :--- | :-------------- |
| `\a` | beep            |
| `\b` | Backspace       |
| `\n` | Newline         |
| `\r` | Carriage return |
| `\t` | Tab             |
