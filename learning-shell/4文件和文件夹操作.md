# 文件和文件夹操作

-   **cp**：复制文件和文件夹
-   **mv**：移动/重命名文件和文件夹
-   **mkdir**：创建文件夹
-   **rm**：删除文件和文件夹
-   **ln**：创建软链接和硬链接

## 通配符（Wildcard/Globbing）

使用通配符可快速选择和过滤文件

**通配符有：**

| 通配符             | 含义                       |
| :-------------- | :----------------------- |
| \*              | 匹配任何长度的任意字符              |
| ?               | 匹配任意一个字符                 |
| [*characters*]  | 匹配任意一个_characters_中的字符   |
| [!*characters*] | 匹配任意一个不是_characters_中的字符 |
| \[[:*class*:]]  | 匹配一个_class_类中的字符         |

**常用字符类_class_：**

| 类         | 含义        |
| :-------- | :-------- |
| [:alnum:] | 匹配一个字母或数字 |
| [:alpha:] | 匹配一个字母    |
| [:digit:] | 匹配一个数字    |
| [:lower:] | 匹配一个小写字母  |
| [:upper:] | 匹配一个大写字母  |

**例：**

| 模式                     | 匹配结果                       |
| :--------------------- | :------------------------- |
| \*                     | 所有文件                       |
| g\*                    | 以“g”开头的任意文件                |
| b\*.txt                | 以“b”开头，后跟任意字符，以“.txt”结尾的文件 |
| Data???                | 以"Data"开头，后跟3个字符的文件        |
| [abc]\*                | 以“a”、“b”或“c”开头的任意文件        |
| BACKUP.[0-9][0-9][0-9] | 以“BACKUP.”开头，后跟3个数字的文件     |
| \[[:upper:]]\*         | 以一个大写字符开头的所有文件             |
| \[![:digit:]]\*        | 不以数字开头的所有文件                |
| \*\[[:lower:]123]      | 以一个小写字母或“1”、“2”或“3”结尾的所有文件 |

## mkdir 创建文件夹

**"..."表示可以重复：**

```bash
me@ubuntu16.04:~$ mkdir directory ...
```

**创建一个文件夹：**

```bash
me@ubuntu16.04:~$ mkdir dir1
```

**创建多个文件夹：**

```bash
me@ubuntu16.04:~$ mkdir dir1 dir2 dir3
```

## cp 复制文件和文件夹

**将item1的内容复制到item2，文件和文件夹都可：**

```bash
me@ubuntu16.04:~$ cp item1 item2
```

**将item...（文件或文件夹）复制到文件夹：**

```bash
me@ubuntu16.04:~$ cp item... directory
```

### 选项和例子

**选项：**

| 选项（简写和全写）        | 含义                     |
| :--------------- | :--------------------- |
| -a --archive     | 同时复制文件所有权和权限           |
| -i --interactive | 如果覆盖已有文件，提醒            |
| -r --recursive   | 如果复制文件夹，同时复制文件夹包含的所有文件 |
| -u --update      | 只复制目标文件夹中不存在的文件        |
| -v --verbose     | 显示复制的详细信息              |

**例：**

| 命令                  | 结果                                      |
| :------------------ | :-------------------------------------- |
| cp file1 file2      | 复制file1到file2。如果file2已存在，覆盖；不存在，创建      |
| cp -i file2 file2   | 如果file2已存在，提示是否覆盖                       |
| cp file1 file2 dir1 | 将file1和file2复制到dir1文件夹。dir1需已存在         |
| cp dir1/\* dir2     | 将dir1中的所有文件复制到dir2。dir2需已存在             |
| cp -r dir1 dir2     | 将dir1中的所有内容复制到dir2。如果dir2不存在，创建；已存在，仅复制 |

## mv 移动或重命名文件

**mv** 命令可用于移动和重命名文件，两种情况下原文件都会被删除。其用法类似于 **cp**。

**重命名文件：**

```bash
me@ubuntu16.04:~$ mv item1 item2
```

**移动文件：**

```bash
me@ubuntu16.04:~$ mv item... directory
```

### 选项和例子

**选项**

与 **cp** 大部分选项相同：

| 选项              | 含义             |
| :-------------- | :------------- |
| i --interactive | 覆盖已有文件前，提示     |
| -u --update     | 不覆盖目标文件夹中的已有文件 |
| -v --verbose    | 显示操作信息         |

**例：**

| 命令                  | 结果                                             |
| :------------------ | :--------------------------------------------- |
| mv file1 file2      | 如果file2已存在，覆盖；不存在，创建。file1被删除                  |
| mv -i file1 file2   | 与上例唯一不同在于，如果file2已存在，提示是否覆盖                    |
| mv file1 file2 dir1 | 将file1和file2移动到文件夹dir1。dir1需已存在                |
| mv dir1 dir2        | 如果dir2不存在，创建，dir1中内容移动到dir2；存在，dir1及其内容移动到dir2 |

## rm 删除文件和文件夹

**删除文件或文件夹：**

```bash
me@ubuntu16.04:~$ mv item...
```

### 选项和例子

**选项：**

| 选项               | 含义                                |
| :--------------- | :-------------------------------- |
| -i --interactive | 删除前提醒                             |
| -r --recursive   | 如果是文件夹，且删除其中的子文件夹，需添加此选项          |
| -f --force       | 不管文件是否存在，都删除。可覆盖`--interactive`选项 |
| -v --verbose     | 显示操作信息                            |

**例：**

| 命令                | 结果                               |
| :---------------- | :------------------------------- |
| rm file1          | 删除file1                          |
| rm -i file1       | 同上例唯一不同在于，删除前提醒                  |
| rm -r file1 dir1  | 删除file1，删除dir1及其中内容              |
| rm -rf file1 dir1 | 与上例唯一不同在于，不管file1和dir1是否存在，都执行命令 |

## ln 创建链接

**创建硬链接，file只能是文件：**

```bash
me@ubuntu16.04:~$ ln file link
```

**创建软链接，item可为文件或文件夹：**

```bash
me@ubuntu16.04:~$ ln -s item link
```

### 硬链接

硬链接是Unix创建链接的传统方式，不如软链接先进。每个文件默认有一个为其名字创建的硬链接。自行创建硬链接时，实质上是为文件创建了额外文件夹入口？。硬链接有两大不足：

-   不能在不同分区间创建硬链接。
-   只能为文件，不能为文件夹创建硬链接。

与软链接不同，当使用“ls -l”命令查看时，硬链接文件的显示方式与普通文件无区别。当硬链接被删除时，只是链接被删除，但所占内存依然存在，当指向该文件的所有链接都被删除后才释放。 _尽量避免使用硬链接。_

### 软链接

软链接的目的就是弥补硬链接的短处。如果为文件或文件夹创建软链接，则生成一个特殊文件，含一个指向引用文件或文件夹的文本指针。

如果修改软链接中的内容，引用文件中的内容也会随之改变。删除软链接后，引用文件并不被删除；如果文件先被删除，软链接依然存在，只是不指向任何文件，此状态为软链接被损坏，当使用"ls"命令时，会使用不同的颜色显示。

## 实践

### 新建文件夹

**根目录下创建playground文件夹，并为其创建两个子文件夹：**

```bash
me@ubuntu16.04:~$ cd
me@ubuntu16.04:~$ mkdir playground
me@ubuntu16.04:~$ cd playground/
me@ubuntu16.04:~/playground$ mkdir dir1 dir2
```

### 复制文件

**将/etc/passwd文件复制到当前文件夹，并列出详细信息。“.”代表当前文件夹：**

```bash
me@ubuntu16.04:~/playground$ cp /etc/passwd .
me@ubuntu16.04:~/playground$ ls -l
total 12
drwxrwxr-x 2 me me 4096 8月  14 15:23 dir1
drwxrwxr-x 2 me me 4096 8月  14 15:23 dir2
-rw-r--r-- 1 me me 2246 8月  14 16:40 passwd
```

**使用“v”选项重新复制，此次覆盖了上次复制的同名文件：**

```bash
me@ubuntu16.04:~/playground$ cp -v /etc/passwd .
'/etc/passwd' -> './passwd'
```

**使用“i”选项再次复制，确认按<kbd>y</kbd>，其它任何字母（如 <kbd>n</kbd>）否认：**

```bash
me@ubuntu16.04:~/playground$ cp -i /etc/passwd .
cp: overwrite './passwd'? y
```

### 移动和重命名

**将"passwd"文件重命名为“fun”：**

```bash
me@ubuntu16.04:~/playground$ mv passwd fun
```

**将“fun”文件来回移动：**

```bash
me@ubuntu16.04:~/playground$ mv fun dir1 #移动到dir1中
me@ubuntu16.04:~/playground$ mv dir1/fun dir2/ #重dir1移动到dir2中
me@ubuntu16.04:~/playground$ mv dir2/fun . #移动到起始位置
```

**文件夹移动：**

```bash
me@ubuntu16.04:~/playground$ mv fun dir1 # 先将fun移动到dir1中
# 将dir1移动到dir2中。如果dir2不存在，则将dir1重命名为dir2
me@ubuntu16.04:~/playground$ mv dir1 dir2
me@ubuntu16.04:~/playground$ ls -l dir2/ # dir2文件夹中的文件信息
total 4
drwxrwxr-x 2 me me 4096 8月  14 16:54 dir1
me@ubuntu16.04:~/playground$ ls -l dir2/dir1/ # dir1文件夹中的文件信息
total 4
-rw-r--r-- 1 me me 2246 8月  14 16:44 fun
me@ubuntu16.04:~/playground$ mv dir2/dir1/ . # 所有文件和文件夹回归原味
me@ubuntu16.04:~/playground$ mv dir1/fun .
```

### 创建硬链接

**为“fun”文件创建3个硬链接，并查看结果：**

```bash
me@ubuntu16.04:~/playground$ ln fun fun-hard
me@ubuntu16.04:~/playground$ ln fun dir1/fun-hard
me@ubuntu16.04:~/playground$ ln fun dir2/fun-hard
me@ubuntu16.04:~/playground$ ls -l #查看文件信息
total 16
drwxrwxr-x 2 me me 4096 8月  14 17:00 dir1
drwxrwxr-x 2 me me 4096 8月  14 17:00 dir2
-rw-r--r-- 4 me me 2246 8月  14 16:44 fun
-rw-r--r-- 4 me me 2246 8月  14 16:44 fun-hard
```

每个文件都有一个默认指向其名字的硬链接，再加上此处创建的3个，“fun”和“fun-hard”就有4个硬链接。但通过“ls”命令，并没有明显特征表明“fun”和“fun-hard”就是同一个文件。

假象每个文件由两部分组成：内容数据和名字。创建硬链接实际上是为同一内存数据创建了额外的名字。系统为_inode_（指向名字部分）表示分配内存。与特定_inode_关联的硬链接含文件内容。

**使用"li"命令的"-i"选项时，结果中的第一项即为_inode_：**

```bash
me@ubuntu16.04:~/playground$ ls -li
total 16
14164373 drwxrwxr-x 2 me me 4096 8月  14 17:00 dir1
14164374 drwxrwxr-x 2 me me 4096 8月  14 17:00 dir2
14164375 -rw-r--r-- 4 me me 2246 8月  14 16:44 fun
14164375 -rw-r--r-- 4 me me 2246 8月  14 16:44 fun-hard
```

_“fun”和“fun-hard”使用同一inode，说明二者为同一文件。_

### 创建软链接

软链接弥补了硬链接的两大缺陷：不能跨分区创建；仅能为文件，不能为文件夹创建链接。软链接为特殊文件，含指向目标文件或文件夹的文本指针。

**如创建硬链接那样创建软链接（与创建硬链接的区别为条件“-s”选项）：**

```bash
me@ubuntu16.04:~/playground$ ln -s fun fun-sym
me@ubuntu16.04:~/playground$ ln -s ../fun dir1/fun-sym
me@ubuntu16.04:~/playground$ ln -s ../fun dir2/fun-sym
```

第一条容易理解，和创建硬链接形式相同。后两条使用了相对路径，原因为： **创建软链接时，软链接路径应相对于目标文件路径**。

**查看创建软链接后dir1中的文件信息：**

```bash
me@ubuntu16.04:~/playground$ ls -l dir1/
total 4
-rw-r--r-- 4 me me 2246 8月  14 16:44 fun-hard
lrwxrwxrwx 1 me me    6 8月  14 17:32 fun-sym -> ../fun
```

-   结果第一项首字母为“l”，表示这是一个软链接文件。
-   第五项为“6”，表示软链接长度，即"../fun"字符串长度。而非目标文件内容大小。
-   最后一项为"fun-sym -> ../fun"，表示目标文件相对位置。

**也可使用绝对路径创建软链接：**

```bash
me@ubuntu16.04:~$ [me@linuxbox playground]$ ln -s /home/me/playground/fun dir1/fun-sym
```

**推荐使用相对路径创建软链接，这样在重命名和移动包含软链接和目标文件的文件夹时，不会破坏软链接。**

**也可为文件夹创建软链接：**

```bash
me@ubuntu16.04:~/playground$ ln -s dir1 dir1-sym
me@ubuntu16.04:~/playground$ ls -l
total 16
drwxrwxr-x 2 me me 4096 8月  14 17:32 dir1
lrwxrwxrwx 1 me me    4 8月  14 17:48 dir1-sym -> dir1
drwxrwxr-x 2 me me 4096 8月  14 17:34 dir2
-rw-r--r-- 4 me me 2246 8月  14 16:44 fun
-rw-r--r-- 4 me me 2246 8月  14 16:44 fun-hard
lrwxrwxrwx 1 me me    3 8月  14 17:31 fun-sym -> fun
```

### 删除文件和文件夹

**删除"fun-hard"。“fun”的硬链接数量（显示结果第2项）又4变为3：**

```bash
me@ubuntu16.04:~/playground$ ls -l
total 16
drwxrwxr-x 2 me me 4096 8月  14 17:32 dir1
lrwxrwxrwx 1 me me    4 8月  14 17:48 dir1-sym -> dir1
drwxrwxr-x 2 me me 4096 8月  14 17:34 dir2
-rw-r--r-- 4 me me 2246 8月  14 16:44 fun
-rw-r--r-- 4 me me 2246 8月  14 16:44 fun-hard
lrwxrwxrwx 1 me me    3 8月  14 17:31 fun-sym -> fun
me@ubuntu16.04:~/playground$ rm fun-hard
me@ubuntu16.04:~/playground$ ls -l
total 12
drwxrwxr-x 2 me me 4096 8月  14 17:32 dir1
lrwxrwxrwx 1 me me    4 8月  14 17:48 dir1-sym -> dir1
drwxrwxr-x 2 me me 4096 8月  14 17:34 dir2
-rw-r--r-- 3 me me 2246 8月  14 16:44 fun
lrwxrwxrwx 1 me me    3 8月  14 17:31 fun-sym -> fun
```

**交互式删除"fun"：**

```bash
me@ubuntu16.04:~/playground$ rm -i fun
rm: remove regular file 'fun'?
```

**以“fun”为目标文件的软链接“fun-sym”会怎样？：**

```bash
me@ubuntu16.04:~/playground$ ls -l
total 8
drwxrwxr-x 2 me me 4096 8月  14 17:32 dir1
lrwxrwxrwx 1 me me    4 8月  14 17:48 dir1-sym -> dir1
drwxrwxr-x 2 me me 4096 8月  14 17:34 dir2
lrwxrwxrwx 1 me me    3 8月  14 17:31 fun-sym -> fun（显示为其它颜色）
```

目标文件删除后，指向此文件的软链接被损坏，使用"ls"命令列出时，会显示为其它颜色提醒。

**尝试使用被损坏的软链接：**

```bash
me@ubuntu16.04:~/playground$ less fun-sym
fun-sym: No such file or directory
```

**删除根目录下的软链接：**

```bash
me@ubuntu16.04:~$ rm fun-sym dir1-sym
me@ubuntu16.04:~/playground$ ls -l
total 8
drwxrwxr-x 2 me me 4096 8月  14 17:32 dir1
drwxrwxr-x 2 me me 4096 8月  14 17:34 dir2
```

**删除整个文件夹：**

```bash
me@ubuntu16.04:~$ cd
me@ubuntu16.04:~$ rm -r playground
```
