# 充分利用命令行

本节将学习到的命令：

-   **type**：命令来源
-   **which**：命令对应的执行程序
-   **help**：内置shell命令帮助文档
-   **man**：显示命令的手册页
-   **apropos**：通过手册文件查找命令
-   **info**：显示命令的info文件
-   **whatis**：显示命令的精简描述
-   **alias**：为命令取一个别名（alias）

## 何为命令

命令可分5大类：

1.  **可执行程序**。比如/usr/bin内的文件。此类程序也可为编程语言（如C等）编译成的二进制文件。
2.  **shell内置命令（shell buitins）**。如“cd”命令。
3.  **shell脚本**。
4.  **别名（alias）**。使用其它命令创建的命令。

## 鉴别命令

鉴别命令为上述4类的哪一种。

### type 显示命令的类别

**使用方法：**

```bash
type command
```

**例：**

```bash
me@ubuntu16.04:~$ type type
type is a shell builtin # shell内置命令
me@ubuntu16.04:~$ type ls
ls is aliased to ‘ls --color=auto’ # ls命令为'ls --color=auto'的别名
me@ubuntu16.04:~$ type cp #
cp is /bin/cp # 可执行程序
```

### which 显示可执行程序的所处位置

一个系统中可能安装有同一可执行程序的不同版本。这类情况在桌面系统中不常见，但在大型服务器上常见。

**显示命令的所处位置：**

```bash
me@ubuntu16.04:~$ which ls
/bin/ls
```

**此命令只对上述4类命令中的可执行程序有效，使用在其它类型上时，不显示任何内容：**

```bash
me@ubuntu16.04:~$ which cd
```

## 获取命令文档

### help 显示shell内置帮助文档

**cd命令帮助文档：**

```bash
me@ubuntu16.04:~$ help cd
# cd: cd [-L|[-P [-e]] [dir]
    Change the shell working directory.

    Change the current directory to DIR.  The default DIR is the value of the
    HOME shell variable.
.......
```

由"help"命令显示的文档精准，但作为教程比较繁琐。

#### cd: cd [-L|\[-P \[-e\]\] \[-@\]][dir]

cd命令可跟“-L”或“-P”选项。如果为“-P”选项，还可跟“-e”选项。最后可选跟文件夹名“dir”。

### --help 显示使用信息

绝大多数可执行程序支持“--help”选项，显示该命令语法和选项。

**显示mkdir命令的使用信息：**

```bash
me@ubuntu16.04:~$ mkdir --help
Usage: mkdir [OPTION]... DIRECTORY...
# Create the DIRECTORY(ies), if they do not already exist.

Mandatory arguments to long options are mandatory for short options too.
  -m, --mode=MODE   set file mode (as in chmod), not a=rwx - umask
  # -p, --parents     no error if existing, make parent directories as needed
  -v, --verbose     print a message for each created directory
...
```

### man 显示可执行程序手册

大多数可执行程序都自带手册，使用“man”命令可查看。手册主要包括如下内容：

-   标题（title）
-   语法（synoosis）
-   目的（description）
-   选项（options）

一般不含使用举例，目的是作为参考文档，而非教程。

**ls命令手册：**

```bash
LS(1)                            User Commands                           LS(1)

NAME
       ls - list directory contents

SYNOPSIS
       ls [OPTION]... [FILE]...
...
```

一份手册可能由8部分组成：

| 编号  | 内容                         |
| :-- | :------------------------- |
| 1   | 用户命令                       |
| 2   | 内核接口                       |
| 3   | 与C库文件接口                    |
| 4   | 特殊文件，如设备nodes和驱动器（drivers） |
| 5   | 文件格式                       |
| 6   | 游戏娱乐                       |
| 7   | 其它                         |
| 8   | 系统管理员命令                    |

默认使用第“1”部分。

**显示/etc/passwd文件的格式：**

```bash
me@ubuntu16.04:~$ man 5 passwd
...
```

### apropos 通过手册文件查找命令

可使用apropos命令搜索所有手册中出现的单词，查找相关命令。

**查找手册中有单词"floppy"单词对应的命令：**

```bash
me@ubuntu16.04:~$ apropos floppy
fdformat (8)         - low-level format a floppy disk
mbadblocks (1)       - tests a floppy disk, and marks the bad blocks in the FAT
mformat (1)          - add an MSDOS filesystem to a low-level formatted flopp...
mxtar (1)            - Wrapper for using GNU tar directly from a floppy disk
```

结果第一部分为对应命令，第二部分为该单词出现在手册的第几部分。"apropos"命令等价与"man"命令加上“-k”选项。

### whatis 显示命令的精简描述

whatis命令仅显示对应命令手册的描述内容，通常只有一行。

**精简描述ls命令：**

```bash
me@ubuntu16.04:~$ whatis ls
ls (1)               - list directory contents
```

> 命令手册通常作为参考，不适合作为教程。虽然阅读困难，但的确非常精确完整。

### info 显示命令的info文件

大多数GNU程序都有其info文件，可视为手册的替代品。其由节点组成，每个节点包含一个话题。阅读info文件的命令有：

| 命令             | 作用    |
| :------------- | :---- |
| ?              | 显示帮助  |
| PgUp或BackSpace | 上一页   |
| PgDn或Space     | 上一页   |
| n              | 下一个节点 |
| p              | 上一个节点 |
| u              | 显示父节点 |
| Enter          | 打开链接  |
| q              | 退出    |

**目前为止，大多数命令都来自GNU的"coreutils"包：**

```bash
me@ubuntu16.04:~$ info coreutils
...
```

### README和其它程序文档

安装包是，许多包都在/usr/share/doc文件夹中写入了文档。大多数为纯文本形式，可使用“less”命令查看；一些为HTML形式，可使用浏览器查看；还有一些以".gz"结尾，表示其为"gzip"命令压缩后的压缩包，可使用“zless”命令查看。

## 使用alias创建自己的命令

单行输入多行命令的方式为，命令间使用“;”隔开：

```bash
command1; command2; command3....
```

**同时执行/usr、ls和cd -命令：**

```bash
me@ubuntu16.04:~$ cd /usr; ls; cd -
bin  games  include  lib  local  locale  sbin  share  src
/home/claudio
```

将上面的3个命令写在一个别名命令中。首先确定新建的别名是否存在，方法为使用"type"命令，如“test”：

**检查“test”别名是否存在：**

```bash
me@ubuntu16.04:~$ type test
test is a shell builtin #已存在
me@ubuntu16.04:~$ type foo
bash: type: foo: not found # 不存在，可用
```

创建别名的方式为：

```bash
alias name='string'
```

**创建“foo”别名，并测试：**

```bash
me@ubuntu16.04:~$ alias foo='cd /usr; ls; cd -'
me@ubuntu16.04:~$ foo
bin  games  include  lib  local  locale  sbin  share  src
/home/claudio
```

**删除别名“foo”：**

```bash
me@ubuntu16.04:~$ unalias foo
me@ubuntu16.04:~$ type foo
bash: type: foo: not found #删除成功
```

**查看所有的别名：**

```bash
me@ubuntu16.04:~$ alias
....
alias egrep='egrep --color=auto'
alias fgrep='fgrep --color=auto'
....
```

_当命令行关闭后，此方法创建的别名消失。_
