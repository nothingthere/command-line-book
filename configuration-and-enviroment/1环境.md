# 环境

每一个shell实例都有一个对应环境（enviroment）。各程序使用此环境中的数据侦测系统配置。尽管绝大多数成熟使用配置文件储存自身设置，但还是有一些以来环境。

本节将学习到的命令：

- **printenv**：打印部分或全部环境数据
- **set**：设置shell选项
- **export**：向执行程序导入环境数据？
- **alias**：使用命令创建别名

## 环境中存储何物？

环境中，shell存储2类数据：环境变量和shell变量。bash负责存储shell变量，除此之外的为环境变量。除变量外，shell还存储别名和shell函数。

### 检测环境

使用shell内置函数set和printenv程序可查看环境中存储的数据，前者显示shell和环境变量，后者只显示环境变量。

**查看环境变量，结合less命令：**

```bash
me@ubuntu16.04:~$ printenv | less
...
```

**使用printenv查看单个变量值：**

```bash
me@ubuntu16.04:~$ printenv USER
me
```

**使用set函数查看shell变量、环境变量和shell函数，结果通常按字母排序：**

```bash
me@ubuntu16.04:~$ set | less
...
```

**set和printenv都不显示别名，需使用alias命令：**

```bash
me@ubuntu16.04:~$ alias
...
```

### 变量举例

下列变量因系统差别较大，仅以本机为例：

- DISPLAY：如果为图像环境，返回值为显示实例名称，通常为":0"，即X server生成的第一个显示实例。
- SHELL：shell程序名称。
- HOME：home文件路径。
- LANG：本机语言设置。
- PATH：执行程序时，对应搜索路径，用冒号隔开。
- PS1：Prompt String 1。shell对话字符串。
- PWD：当前目录。
- TERM：命令行类型。类Unix系统支持多种命令行协议；此变量用于设置本机命令行模拟器。
- USER：用户名。

## 环境如何建立？

当登陆系统时，basg程序启动，读取配置脚本（_startup files_，定义所有用户共享的环境配置）。随后读取home文件夹内的启动文件，配置各用户单独环境。读取顺序取决于启用何种shell实例：登陆实例和非登陆实例。

登陆实例需输入用户名和密码，如虚拟机命令行；非登陆实例通常在图形界面环境中使用。

登陆实例读取下列一个或多个启动文件：

- /etc/profile：所有用户共享的全局配置脚本。
- ~/.bash_profile：用户私有启动文件。可用于扩展或重置全局配置。
- ~/.bash_login：如果不能找到~/.bash_profile文件，bash尝试使用此文件代替
- ~/.profile：如果~/.bash_profile和~/.bash_login都未找到，bash尝试使用此文件代替。Debian类系统如Ubuntu默认使用此文件。

非登陆实例使用下例2个文件多为启动文件：

- /etc/bash.bashrc：所有用户共享的全局配置脚本。
- ~/.bashrc：用户私有启动文件。可用于扩展或重置全局配置。

除读取上述启动文件外，非登陆实例通常还从其父进程（一般为登陆实例）继承环境配置。

对普通用户而言，~/.bashrc文件始终需读取，所以是最重要的文件。

### 简单分析启动文件

下面是~/.profile文件中的内容（Ubuntu）：

```bash
#umask 022

# if running bash
if [ -n "$BASH_VERSION" ]; then
    # include .bashrc if it exists
    if [ -f "$HOME/.bashrc" ]; then
        . "$HOME/.bashrc"
    fi
fi

# set PATH so it includes user's private bin directories
PATH="$HOME/bin:$HOME/.local/bin:$PATH"
```

- `#`：注释语句
- `if`：条件语句的含义为：
- `PATH=...`：以ls命令为例，当使用ls命令时，不是直接搜索并执行/bin/ls程序，而是根据PATH参数来计算。

## 修改环境

**基本规则，如需在PATH中增加文件夹，或者定义额外环境变量，修改.bash_profile文件（或等价文件，如Ubuntu中的.profile文件）；其它所有修改，更改.bashrc文件。**

_修改重要文件时，最好先为其保留副本，以免造成系统崩溃。如修改.bashrc文件，最好为其新建副本".bashrc.bak"，后缀名易识别即可。_

**备份.bashrc文件：**

```bash
me@ubuntu16.04:~$ cp .bashrc .bashrc.bak
```

**在.bashrc文件末添加下列内容：**

```bash
# 自己修改的内容
# 只显示隐藏文件和文件夹的别名
alias l.='ls -dF .[!.]* --color=auto'
```

**修改后.bashrc文件只有在新的shell实例中生效，如需使其在当前实例中生效，可使用source命令：**

```bash
me@ubuntu16.04:~$ source .bashrc
```

**尝试新定义的"l."别名：**

```bash
me@ubuntu16.04:~$ l.
...
```
