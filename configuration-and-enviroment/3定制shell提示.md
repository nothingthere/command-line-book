# 定制shell提示

## 解析提示字符串

**查看一下命令行提示格式：**

```bash
me@ubuntu16.04:~$ echo $PS1
# 各系统上差异较大，这里使用简单举例
\u@\h \W \$
```

PS1变量为“Prompt String 1”的缩写。

看起来很怪异，实际上大部分是一些特殊字符：

-   \\a：ANCII警报。计算机解析到此字符串时发出警报（本机测试失败）。
-   \\d：日期。格式为“周几 月份 号数”。如“四 8月 25”。
-   \\h：去除后缀域名后的，本机主机名。
-   \\H：完整主机名。
-   \\j：当前shell实例中已有的job数量。
-   \\l：当前命令行设备名称。一般为“0”。
-   \\n：换行字符。
-   \\r：回车字符。
-   \\s：shell程序的名称。一般为“bash”。
-   \\t：当前时间，格式为“时:分:秒”，24小时格式。
-   \\T：当前时间，12小时格式。
-   \\@：当前时间，12小时格式，显示“上午”/“下午”。
-   \\A：当前时间，24小时格式，不显示秒数，“时:分”。
-   \\u：当前用户名。
-   \\v：shell版本号。
-   \\V：shell版本和发行号。
-   \\w：当前目录。
-   \\W：当前目录的最后一部分。
-   \\!：当前命令在命令历史记录里的排序。
-   \\#：当前shell实例中已输入的命令数量
-   \\$：如果是超级用户显示“$”，否则显示“#”。
-   \\\[：标示一个或多个非打印控制字符串的开始。这类字符串可控制光标和颜色等。
-   \\]：标示一个或多个非打印控制字符串的开始。

## 尝试改变提示

_命令行中的修改只在当前shell实例中有效，所以请放心使用。_

**将PS1变量缓存，及恢复：**

```bash
# 缓存到变量ps1_old
me@ubuntu16.04:~$ ps1_old="$PS1"
# 查看是否缓存成功
me@ubuntu16.04:~$ echo $ps1_old
# 更改PS1变量，立即生效
me@ubuntu16.04:~$ PS1="....."
.........
# 恢复PS1变量默认值
me@ubuntu16.04:~$ PS1="$ps1_old"
```

**使用每条命令开始执行时发出警报（本机测试失败）：**

```bash
me@ubuntu16.04:~$ PS1="\[\a\]\$ "
$
```

使用\\[和\\]是因为\\a字符并不打印出来。

**使提示信息包含主机名和当前时间：**

```bash
$ PS1="\A \h \$ "
16:18 ubuntu16.04 $
```

## 添加颜色

绝大多数命令行模拟程序都使用，非打印字符控制字符属性（如颜色、粗细等），以及光标位置。

将ANSI转义码（ANSI escape code），嵌入到命令模拟器提示字符串中，即可时间对命令行模拟器发送指令的功能。ANSI转义码为非打印字符，需置于\\[和\\]内。

ANSI转义码以8进制数“033”开头，后为\\\[，后为属性字符（可选），最后为指令字符。

以`\033[0;30m]`为例，其中`\[`和`;`间的`0`为属性字符，可取值为：

-   `0`：正常。
-   `1`：加粗。
-   `4`：下划线。
-   `5`：闪烁（通常已被禁用）。
-   `7`：反转（inverse）。

下表为常见颜色及其对应ANSI转义码：

| 转义码          | 颜色  | 转义码          | 颜色  |
| :----------- | :-- | :----------- | :-- |
| `\033[0;30m` | 黑   | `\033[1;30m` | 深灰  |
| `\033[0;31m` | 红   | `\033[1;31m` | 浅红  |
| `\033[0;32m` | 绿   | `\033[1;32m` | 浅绿  |
| `\033[0;33m` | 棕   | `\033[1;33m` | 黄   |
| `\033[0;34m` | 蓝   | `\033[1;34m` | 浅蓝  |
| `\033[0;35m` | 粉   | `\033[1;35m` | 浅粉  |
| `\033[0;36m` | 蓝绿  | `\033[1;36m` | 浅蓝绿 |
| `\033[0;37m` | 灰白  | `\033[1;37m` | 白   |

**将提示字符串颜色设置为绿色：**

```bash
me@ubuntu16.04:~$ PS1="\[\033[0;32m]\]\A \h \$ "
...
```

**通过上述设置后，当输入命令时也是设置的颜色。模拟器遇见ANSI转义码时开始转换颜色，还原原来颜色需使用转义码`\033[0m`：**

```bash
me@ubuntu16.04:~$ PS1="\[\033[0;32m]\]\A \h \$ "
...
```

下表为常用背景颜色ANSI转义码（不支持加粗属性，也使用`\033[0m`还原）：

| 转义码           | 背景色 | 转义码           | 背景色 |
| :------------ | :-- | :------------ | :-- |
| `\033[0;40m]` | 黑   | `\033[0;44m]` | 蓝   |
| `\033[0;41m]` | 红   | `\033[0;45m]` | 粉   |
| `\033[0;42m]` | 绿   | `\033[0;46m]` | 蓝绿  |
| `\033[0;43m]` | 棕   | `\033[0;47m]` | 灰白  |

**将提示字符串背景色设置为绿色：**

```bash
me@ubuntu16.04:~$ PS1="\[\033[0;42m\]\A \h \$\[\033[0;0m\] "
...
```

## 移动光标

以`PS1="\[\033[s\033[0;0H\033[0;41m\033[K\033[1;33m\t\033[0m\033[u\]
<\u@\h \W>\$ "`，在命令行顶部显示红底黄字的当前时间，为例：

-   `\[`：标记非打印字符开始。帮助bash计算可见字符串长度。
-   `\033[s`：缓存当前光标位置。_一些命令行模拟器不能识别此字符。_
-   `\033[0;0H`：将光标置于第一行，第一列。
-   `\033[0;41m`：将背景色设置为红色。
-   `\033[K`：从光标处清除到行尾。相当于换行作用，使之前的设置占满整行；_光标位置并不变化_。
-   `\033[1;33m`：将文本颜色设置为黄色。
-   `\t`：显示当前时间。虽然这是一个打印字符，为了不使bash计算提示字符串实际长度时，将其计算在内，所以任然包裹在`\[\]`内。
-   `033m[0m`：还原文本和背景色。
-   `\033[u`：还原已缓存的光标位置。
-   `\]`：结束非打印转义字符。
-   `<\u@\h \W>\$`：真正的提示字符串。

下列为表示光标移动的ANSI转义码：

-   `\033[l;cH`：移至l行c列。
-   `\033[nA`：向上移动n行。
-   `\033[nB`：向下移动n行。
-   `\033[nC`：向前移动n个字符位置。
-   `\033[nD`：向后移动n个字符位置。
-   `\033[2J`：清屏，并移至左上角（0行0列）。
-   `\033[k`：从当前位置清除到行末。
-   `\033[s`：缓存光标位置。
-   `\033[u`：还原光标位置。

## 保存

**为使设置永久生效，在.bashrc文件中添加在命令行中一样的复制语句即可：**

```bash
PS1="\[\033[s\033[0;0H\033[0;41m\033[K\033[1;33m\t\033[0m\033[u\]<\u@\h \W>\$ "
```
