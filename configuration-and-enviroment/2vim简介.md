# vim简介

## 启动和关闭

有些系统没有默认安装vim，有的系统默认安装的vim版本功能不全，最好重新安装vim：

```bash
sudo apt install vim
```

如果vim使用的是兼容模式，实际上只有vi的功能。禁用兼容模式有2种方法：

-   在.bashrc文件中添加：`alias vi='vim'`。
-   在.vimrc文件中添加“set noco”：`echo "set nocp" >> ~/.vimrc`

vim有编辑模式、命令模式和执行模式（ex mode），命令模式下几乎每个按键都是命令。

-   命令模式->编辑模式：使用<kbd>i</kbd>键。
-   编辑模式->命令模式：使用<kbd>Esc</kbd>键。
-   执行模式是在命令模式下按<kbd>:</kbd>，再输入需执行的命令。后文以":"开头的命令都为执行命令，简称命令。

**启动时可跟文件名或不跟文件名，如果文件不存在，则创建该文件：**

```bash
me@ubuntu16.04:~$ vim [file...]
...
```

使用q命令退出：`:q`。如果报错，很可能是文件为保存，强制退出的命令为：`q!`。

## 保存

-   `:w`：保存当前文件。
-   `:w filename`：将当前文件重命名为“filename”。_当前编辑的文件任为原文件_。
-   `:wq`：保存并退出。
-   <kbd>ZZ</kbd>：命令模式下与`:wq`等价，即保存并退出。

## 移动光标

| 按键                                   | 作用                         |
| :----------------------------------- | :------------------------- |
| <kbd>l</kbd>/<kbd>Right</kbd>        | 向右移动一个字符                   |
| <kbd>h</kbd>/<kbd>Left</kbd>         | 向左移动一个字符                   |
| <kbd>j</kbd>/<kbd>Down</kbd>         | 移入下一行                      |
| <kbd>k</kbd>/<kbd>Up</kbd>           | 移入上一行                      |
| <kbd>0</kbd>                         | 移至行首                       |
| <kbd>^</kbd>                         | 移至当前行首非空字符处                |
| <kbd>$</kbd>                         | 移至行尾                       |
| <kbd>w</kbd>                         | 移至下一个单词首部或标点处              |
| <kbd>W</kbd>                         | 移至下一个单词首部，忽略标点符号           |
| <kbd>b</kbd>                         | 移至上一个单词首部或标点处              |
| <kbd>B</kbd>                         | 移至上一个单词首部，忽略标点符号           |
| <kbd>Ctrl-f</kbd>/<kbd>Pg Down</kbd> | 向下翻页                       |
| <kbd>Ctrl-b</kbd>/<kbd>Pg Up</kbd>   | 向上翻页                       |
| _number_<kbd>G</kbd>                 | 移至第几行。如1<kbd>G</kbd>为移至第一行 |
| <kbd>G</kbd>                         | 移至最后一行                     |

上述部分命令同1<kbd>G</kbd>，前缀数字，可指定移动步数。如使用3<kbd>j</kbd>向下移动3行。

_上述命令使用less命令时同样可用。_

## 基本编辑

### 文本插入

-   <kbd>i</kbd>：在光标_处_开始插入。
-   <kbd>a</kbd>：在光标_后_开始插入。
-   <kbd>A</kbd>：在行末开始插入。

### 插入新行

-   <kbd>o</kbd>：在当前行_下_插入新行。
-   <kbd>O</kbd>：在当前行_上_插入新行。

### 删除文本

**反悔：<kbd>u</kbd>。**

_number_<kbd>x</kbd>：删除当前行中的字符，使用前缀数字可指定删除当前行中多少个字符。

使用<kbd>b</kbd>实现对行的删除：

| 命令              | 删除              |
| :-------------- | :-------------- |
| <kbd>x</kbd>    | 当前字符            |
| <kbd>3x</kbd>   | 当前字符和后面两个       |
| <kbd>dd</kbd>   | 当前行             |
| <kbd>4dd</kbd>  | 当前行和后面3行        |
| <kbd>dW</kbd>   | 光标处到下一个单词首      |
| <kbd>d$</kbd>   | 光标处到行尾          |
| <kbd>d0</kbd>   | 光标处到行首起第一个非空格字符 |
| <kbd>d^</kbd>   | 光标处到行首起第一个非空格字符 |
| <kbd>dG</kbd>   | 当前行和其后所有内容      |
| <kbd>d20G</kbd> | 当前行到整个文本中第20行   |

### 剪切、复制和粘贴

使用<kbd>x</kbd>和<kbd>d</kbd>命令删除的文本都在“缓冲区（buffer）”内，可使用<kbd>p</kbd>命令粘贴。

复制使用<kbd>y</kbd>命令，与<kbd>d</kbd>命令使用形式完全相同：

| 命令              | 复制              |
| :-------------- | :-------------- |
| <kbd>yy</kbd>   | 当前行             |
| <kbd>4yy</kbd>  | 当前行和后面3行        |
| <kbd>yW</kbd>   | 光标处到下一个单词首      |
| <kbd>y$</kbd>   | 光标处到行尾          |
| <kbd>y0</kbd>   | 光标处到行首起第一个非空格字符 |
| <kbd>y^</kbd>   | 光标处到行首起第一个非空格字符 |
| <kbd>yG</kbd>   | 当前行和其后所有内容      |
| <kbd>y20G</kbd> | 当前行到整个文本中第20行   |

### 合并行

<kbd>J</kbd>：合并行。

## 查找和替换

### 行内搜索

行内搜索使用<kbd>f</kbd>命令。比如在当前行内搜索“a”字符，使用<kbd>fa</kbd>。使用<kbd>;</kbd>跳转到下一个匹配处。

### 整个文件内搜索

与less命令使用方法相同，使用<kbd>/</kbd>，在后输入搜索正则，跳转到下一个匹配处使用<kbd>n</kbd>。

### 整个文件内查找和替换

使用执行模式实现查找替换，比如将整个文件中的“line”替换为“Line”的命令为：`:%s/line/Line/g`。

各字符的含义为：

-   `:`：执行模式的标志。
-   `%`：指定操作范围。`%`为第一行到最后一行的缩写，第一行到第五行为`1,5`，第一行到最后一行为`1,$`。如果省略范围，默认只在当前行内操作。
-   `s`：操作类型，此处代表查找替换。
-   `/line/Line`：搜索和替换的正则。
-   `g`：“global”，在整个文本中替换。如果省略，只替换第一个匹配的字段。

如需确认提醒，需在最后添加“c”（confirm）:`:%s/line/Line/g`。

```bash
:%s/line/Line/gc
replace with Line (y/n/a/q/l/^E/^Y)?
```

各确认选项的含义分别为：

| 按键                                  | 作用               |
| :---------------------------------- | :--------------- |
| <kbd>y</kbd>                        | 确认所有替换           |
| <kbd>b</kbd>                        | 跳过当前匹配           |
| <kbd>a</kbd>                        | 替换当前和其后的所有匹配     |
| <kbd>q</kbd>/<kbd>Esc</kbd>         | 放弃替换             |
| <kbd>l</kbd>                        | "last"，执行当前替换并退出 |
| <kbd>Ctrl-e</kbd>/<kbd>Ctrl-y</kbd> | 向上/下浏览？          |

## 多文件编辑

**可使用vim程序同时打开多个文件：**

```bash
me@ubuntu16.04:~$ vim file file2....
...
```

打开后只显示第一个文件，其它文件都在缓冲区内。

### 文件间跳转

-   `:n`：跳转到下一个缓冲区。
-   `:N`：跳转到上一个缓冲区。
-   `:buffers`：列出所有缓冲区，包含编号和文件名。其中编号可为`:buffer`命令使用。
-   `:buffer 2`：跳转到第2个缓冲区。

### 添加新文件

使用`:e`（“edit”的缩写）可打开新文件：

**将foo.txt添加到缓冲区：**

```bash
:e foo.txt
```

### 将文件内容读取到当前文件

缓冲区内的所有文件间可实现复制和粘贴功能。

### 将整个文件插入到当前文件

使用`:r`（“read”的缩写）可将另一个文件的内容完全插入到当前缓冲区：

**将foo.txt插入到当前缓冲区：**

```bash
:r foo.txt
```
